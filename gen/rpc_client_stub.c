/*
 * AUTO-GENERATED FILE. DO NOT EDIT.
 * Generated by: tools/gen_rpc_client_stub.py
 */

#include <stdio.h>
#include <stdlib.h>
#include <stdint.h>
#include <stdbool.h>

#include "cJSON.h"
#include "rpc_client.h"
#include "rpc_api.h"

static uint32_t g_rpc_request_id = 1;

// 构造 JSON-RPC 2.0 请求字符串：{jsonrpc, method, params, id}。
// 返回堆上分配的字符串，调用者需要 free()。
static char* rpc_build_request(const char* method, cJSON* params)
{
    cJSON* root = cJSON_CreateObject();
    if (root == NULL) {
        return NULL;
    }
    if (cJSON_AddStringToObject(root, "jsonrpc", "2.0") == NULL) {
        cJSON_Delete(root);
        return NULL;
    }
    if (cJSON_AddStringToObject(root, "method", method) == NULL) {
        cJSON_Delete(root);
        return NULL;
    }
    if (params != NULL) {
        cJSON_AddItemToObject(root, "params", params);
    }
    cJSON_AddNumberToObject(root, "id", (double)g_rpc_request_id++);

    char* out = cJSON_PrintUnformatted(root);
    cJSON_Delete(root);
    return out;
}

// 解析 JSON 字符串为 cJSON 对象。
// 返回 cJSON*，调用者需要使用 cJSON_Delete() 释放。
static cJSON* rpc_parse_response(const char* json)
{
    if (json == NULL) {
        return NULL;
    }
    return cJSON_Parse(json);
}

// Return a + b
int32_t add(int32_t a, int32_t b)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    char* req = rpc_build_request("add", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0;
    }
    int32_t v = (int32_t)result->valuedouble;
    cJSON_Delete(root);
    return v;
}

// Return a - b
int32_t sub(int32_t a, int32_t b)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    char* req = rpc_build_request("sub", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0;
    }
    int32_t v = (int32_t)result->valuedouble;
    cJSON_Delete(root);
    return v;
}

// Return a + b + c
int32_t add_3(int32_t a, int32_t b, int32_t c)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    cJSON_AddNumberToObject(params, "c", (double)c);
    char* req = rpc_build_request("add_3", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0;
    }
    int32_t v = (int32_t)result->valuedouble;
    cJSON_Delete(root);
    return v;
}

// Return a - b - c
int32_t sub_3(int32_t a, int32_t b, int32_t c)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    cJSON_AddNumberToObject(params, "c", (double)c);
    char* req = rpc_build_request("sub_3", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0;
    }
    int32_t v = (int32_t)result->valuedouble;
    cJSON_Delete(root);
    return v;
}

// Return a + b (double)
double add_double(double a, double b)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0.0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    char* req = rpc_build_request("add_double", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0.0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0.0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0.0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0.0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0.0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0.0;
    }
    double v = (double)result->valuedouble;
    cJSON_Delete(root);
    return v;
}

// Return a - b (double)
double sub_double(double a, double b)
{
    cJSON* params = cJSON_CreateObject();
    if (params == NULL) {
        return 0.0;
    }
    cJSON_AddNumberToObject(params, "a", (double)a);
    cJSON_AddNumberToObject(params, "b", (double)b);
    char* req = rpc_build_request("sub_double", params);
    if (req == NULL) {
        cJSON_Delete(params);
        return 0.0;
    }
    char* resp_json = rpc_client_call(req);
    free(req);
    if (resp_json == NULL) {
        return 0.0;
    }

    cJSON* root = rpc_parse_response(resp_json);
    free(resp_json);
    if (root == NULL) {
        return 0.0;
    }

    cJSON* err = cJSON_GetObjectItemCaseSensitive(root, "error");
    if (err != NULL) {
        cJSON_Delete(root);
        return 0.0;
    }

    cJSON* result = cJSON_GetObjectItemCaseSensitive(root, "result");
    if (result == NULL) {
        cJSON_Delete(root);
        return 0.0;
    }
    if (!cJSON_IsNumber(result)) {
        cJSON_Delete(root);
        return 0.0;
    }
    double v = (double)result->valuedouble;
    cJSON_Delete(root);
    return v;
}
