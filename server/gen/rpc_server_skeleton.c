/*
 * AUTO-GENERATED FILE. DO NOT EDIT.
 * Generated by: tools/gen_rpc_server_skeleton.py
 */

#include <string.h>
#include <stdio.h>
#include <stdlib.h>
#include "rpc_server_skeleton.h"
#include "rpc_server_helpers.h"
#include "rpc_server_impl.h"

bool rpc_parse_params_ping(cJSON* params)
{
    if (params == NULL) {
        return false;
    }
    return true;
}

bool rpc_parse_params_echo_i64(cJSON* params, int64_t* out_x)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_x = cJSON_GetObjectItemCaseSensitive(params, "x");
    if (!rpc_parse_i64_value(item_x, out_x)) {
        return false;
    }
    return true;
}

bool rpc_parse_params_add_i32(cJSON* params, int32_t* out_a, int32_t* out_b)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_a = cJSON_GetObjectItemCaseSensitive(params, "a");
    if (!cJSON_IsNumber(item_a)) {
        return false;
    }
    *out_a = (int32_t)item_a->valuedouble;
    cJSON* item_b = cJSON_GetObjectItemCaseSensitive(params, "b");
    if (!cJSON_IsNumber(item_b)) {
        return false;
    }
    *out_b = (int32_t)item_b->valuedouble;
    return true;
}

bool rpc_parse_params_mul_double(cJSON* params, double* out_a, double* out_b)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_a = cJSON_GetObjectItemCaseSensitive(params, "a");
    if (!cJSON_IsNumber(item_a)) {
        return false;
    }
    *out_a = (double)item_a->valuedouble;
    cJSON* item_b = cJSON_GetObjectItemCaseSensitive(params, "b");
    if (!cJSON_IsNumber(item_b)) {
        return false;
    }
    *out_b = (double)item_b->valuedouble;
    return true;
}

bool rpc_parse_params_is_even(cJSON* params, int32_t* out_n)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_n = cJSON_GetObjectItemCaseSensitive(params, "n");
    if (!cJSON_IsNumber(item_n)) {
        return false;
    }
    *out_n = (int32_t)item_n->valuedouble;
    return true;
}

bool rpc_parse_params_strlen_s(cJSON* params, const char** out_s)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_s = cJSON_GetObjectItemCaseSensitive(params, "s");
    if (!cJSON_IsString(item_s) || item_s->valuestring == NULL) {
        return false;
    }
    *out_s = item_s->valuestring;
    return true;
}

bool rpc_parse_params_mix3(cJSON* params, int32_t* out_a, double* out_b, bool* out_ok)
{
    if (params == NULL) {
        return false;
    }
    cJSON* item_a = cJSON_GetObjectItemCaseSensitive(params, "a");
    if (!cJSON_IsNumber(item_a)) {
        return false;
    }
    *out_a = (int32_t)item_a->valuedouble;
    cJSON* item_b = cJSON_GetObjectItemCaseSensitive(params, "b");
    if (!cJSON_IsNumber(item_b)) {
        return false;
    }
    *out_b = (double)item_b->valuedouble;
    cJSON* item_ok = cJSON_GetObjectItemCaseSensitive(params, "ok");
    if (!cJSON_IsBool(item_ok)) {
        return false;
    }
    *out_ok = (item_ok->type & cJSON_True) != 0;
    return true;
}

char* rpc_server_dispatch(const char* req_json)
{
    if (req_json == NULL) {
        return rpc_build_error_response(0, -32600, "Invalid Request");
    }

    cJSON* root = cJSON_Parse(req_json);
    if (root == NULL) {
        return rpc_build_error_response(0, -32700, "Parse error");
    }

    cJSON* id_item = cJSON_GetObjectItemCaseSensitive(root, "id");
    uint32_t id = 0;
    if (cJSON_IsNumber(id_item)) {
        if (id_item->valuedouble < 0 || id_item->valuedouble > (double)UINT32_MAX) {
            cJSON_Delete(root);
            return rpc_build_error_response(0, -32600, "Invalid Request");
        }
        id = (uint32_t)id_item->valuedouble;
    }

    cJSON* method = cJSON_GetObjectItemCaseSensitive(root, "method");
    if (!cJSON_IsString(method) || method->valuestring == NULL) {
        cJSON_Delete(root);
        return rpc_build_error_response(id, -32600, "Invalid Request");
    }

    cJSON* params = cJSON_GetObjectItemCaseSensitive(root, "params");
    if (params == NULL) {
        params = cJSON_CreateObject();
        if (params == NULL) {
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32603, "Internal error");
        }
    } else {
        params = cJSON_Duplicate(params, 1);
        if (params == NULL) {
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32603, "Internal error");
        }
    }

    const char* m = method->valuestring;
    char* resp_json = NULL;
    if (strcmp(m, "ping") == 0) {
        char* r = NULL;
        r = ping_impl();
        if (r == NULL) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32603, "Internal error");
        }
        cJSON* result = cJSON_CreateString(r);
        free(r);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "echo_i64") == 0) {
        int64_t x = 0;
        int64_t r = 0;
        if (!rpc_parse_params_echo_i64(params, &x)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = echo_i64_impl(x);
        char buf[32];
        snprintf(buf, sizeof(buf), "%" PRId64, r);
        cJSON* result = cJSON_CreateString(buf);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "add_i32") == 0) {
        int32_t a = 0;
        int32_t b = 0;
        int32_t r = 0;
        if (!rpc_parse_params_add_i32(params, &a, &b)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = add_i32_impl(a, b);
        cJSON* result = cJSON_CreateNumber((double)r);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "mul_double") == 0) {
        double a = 0;
        double b = 0;
        double r = 0;
        if (!rpc_parse_params_mul_double(params, &a, &b)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = mul_double_impl(a, b);
        cJSON* result = cJSON_CreateNumber((double)r);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "is_even") == 0) {
        int32_t n = 0;
        bool r = 0;
        if (!rpc_parse_params_is_even(params, &n)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = is_even_impl(n);
        cJSON* result = cJSON_CreateBool(r);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "strlen_s") == 0) {
        const char* s = 0;
        int32_t r = 0;
        if (!rpc_parse_params_strlen_s(params, &s)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = strlen_s_impl(s);
        cJSON* result = cJSON_CreateNumber((double)r);
        resp_json = rpc_build_result_response(id, result);
    }
    else if (strcmp(m, "mix3") == 0) {
        int32_t a = 0;
        double b = 0;
        bool ok = 0;
        char* r = NULL;
        if (!rpc_parse_params_mix3(params, &a, &b, &ok)) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32602, "Invalid params");
        }
        r = mix3_impl(a, b, ok);
        if (r == NULL) {
            cJSON_Delete(params);
            cJSON_Delete(root);
            return rpc_build_error_response(id, -32603, "Internal error");
        }
        cJSON* result = cJSON_CreateString(r);
        free(r);
        resp_json = rpc_build_result_response(id, result);
    }
    else {
        resp_json = rpc_build_error_response(id, -32601, "Method not found");
    }

    cJSON_Delete(params);
    cJSON_Delete(root);
    return resp_json;
}
